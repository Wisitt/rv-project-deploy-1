var ke=Object.defineProperty;var Te=(l,o,i)=>o in l?ke(l,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[o]=i;var d=(l,o,i)=>(Te(l,typeof o!="symbol"?o+"":o,i),i);import{r as a,G as g,j as e,a1 as L,S as Ee,p as Pe,B as n,y as ee}from"./index-bd07fbd0.js";import{r as Re,i as Ne,d as qe,a as Ie,D as Oe}from"./WarningRounded-425b6d8a.js";import{H as ze,a as Fe,T as Le,b as He,c as te,C as We,O as P}from"./Pagination-e67015c6.js";import{R}from"./RoomService-c8fe411e.js";import{u as Be}from"./useRoomState-ac6d5c61.js";import{d as H,L as pe}from"./useMobilePicker-f4f29c97.js";import{N as be,D as ge,a as fe}from"./TimePicker-fed58599.js";import{T as Me,C as _e}from"./Table-8b23f94b.js";import{M as W}from"./Modal-47ea7b4d.js";import{M as B}from"./ModalDialog-cb89a8c8.js";import{D as M}from"./DialogTitle-138756e8.js";import{D as Ue,a as U,F as p}from"./DialogActions-cb15ede7.js";import{F as m,I as $}from"./FormControl-0effa5e0.js";import{S as N}from"./Select-9b9debbb.js";import"./createSvgIcon-d571b62c.js";import"./styled-ee573952.js";import"./ownerWindow-ac4bdde2.js";import"./useControlled-138fc601.js";import"./useEventCallback-469884d9.js";import"./index-677c1661.js";import"./Typography-40bc49a3.js";import"./Paper-862ef224.js";import"./useMediaQuery-a8cdde77.js";import"./useFormControl-b799abd8.js";import"./DialogContext-fbabc464.js";import"./Grid-cc899c58.js";import"./FormControlContext-cf683adc.js";import"./cardOverflowClasses-6b415049.js";const $e=()=>{const[l,o]=a.useState([]),[i,q]=a.useState(!1),[y,D]=a.useState([]),[b,I]=a.useState(1),[x,G]=a.useState(5),[V,w]=a.useState(!1),[O,f]=a.useState(!1),[S,A]=a.useState(null),[z,k]=a.useState(!1),{AddSubject:_,editingSubject:j,subject:X,setSubject:T,setEditSubject:C,setAddSubject:F,handleInputChangeSubject:Y,handleInputEditChangeSubject:J}=Be(),c=a.useCallback(async()=>{try{const s=await R.getAllSubject({page:b,pageSize:x});o(s)}catch(s){console.error("Error fetching subject response:",s)}},[b,x]);return a.useEffect(()=>{c()},[c]),{listItems:l,selectAll:i,selectedItems:y,page:b,rowsPerPage:x,deleteDialogOpen:O,itemToDelete:S,subject:X,AddSubject:_,addDialogOpen:z,editingSubject:j,editDialogOpen:V,setSubject:T,setEditSubject:C,setAddSubject:F,handleInputChangeSubject:Y,handleInputEditChangeSubject:J,handleSelectAll:()=>{q(!i),D(i?[]:l.map(s=>s.subject_id))},handleCloseEditDialog:()=>{C({id:"",subject_id:"",subject_name:"",subject_code:"",user_id:"",firstname:""}),w(!1)},handleCloseAddDialog:()=>{k(!1)},handleCheckboxChange:s=>{D(u=>u.includes(s)?u.filter(Q=>Q!==s):[...u,s])},fetchSubjectList:c,handleDelete:async s=>{await c(),A(s),f(!0)},handleDeleteConfirmed:async()=>{try{if(S!==null){await R.deleteSubject(S);const s=l.filter(u=>u.subject_id!==S);o(s),A(null),g.success("Subject deleted successfully")}else{await Promise.all(y.map(async u=>R.deleteSubject(u)));const s=l.filter(u=>!y.includes(u.subject_id));o(s),D([]),g.success("Subjects deleted successfully")}await c(),f(!1)}catch(s){console.error("Error deactivating subject(s):",s)}},handleDeleteAll:()=>{f(!0)},handleCloseDeleteDialog:()=>{f(!1)},handleChangePage:async s=>{I(s),await c()},handleChangeRowsPerPage:s=>{G(s),I(1),c()},handleEdit:s=>{C(s),w(!0)},handleAdd:()=>{T({id:"",subject_id:"",subject_name:"",subject_code:"",user_id:"",firstname:""}),k(!0)},handleAddConfirmed:async()=>{if(!(!_.subject_name||!_.subject_code||!_.user_id)){try{const s=await R.addSubject(_);console.log("API Response:",s),await c(),k(!1),T({id:"",subject_id:"",subject_name:"",subject_code:"",user_id:"",firstname:""}),g.success("Subject add successfully:")}catch(s){console.error("Error adding subject:",s)}F({id:"",subject_id:"",subject_name:"",subject_code:"",user_id:"",firstname:""})}},handleEditConfirmed:async()=>{if(!(!j.subject_name||!j.subject_code||!j.user_id||!j.firstname)&&j){try{const s=await R.updateSubject(j.subject_id,{...j});s.status===200?C({id:"",subject_id:"",subject_name:"",subject_code:"",user_id:"",firstname:""}):g.error(s.data.message)}catch(s){console.error("Error updating subject:",s)}g.success("Subject updated successfully:"),await c(),w(!1)}}}};var se={},Ge=Ne;Object.defineProperty(se,"__esModule",{value:!0});var Ce=se.default=void 0,Ve=Ge(Re()),Xe=e,Ye=(0,Ve.default)((0,Xe.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");Ce=se.default=Ye;class Dt{constructor(){d(this,"subject_id");d(this,"day_of_week");d(this,"start_time");d(this,"end_time");d(this,"room_id")}}class wt{constructor(){d(this,"id");d(this,"subject_id");d(this,"day_of_week");d(this,"start_time");d(this,"end_time");d(this,"room_id")}}const At=()=>{const{listItems:l,selectAll:o,selectedItems:i,page:q,rowsPerPage:y,deleteDialogOpen:D,AddSubject:b,addDialogOpen:I,editingSubject:x,editDialogOpen:G,setEditSubject:V,setAddSubject:w,handleInputChangeSubject:O,handleInputEditChangeSubject:f,handleSelectAll:S,handleCloseEditDialog:A,handleCloseAddDialog:z,handleCheckboxChange:k,fetchSubjectList:_,handleDelete:j,handleDeleteConfirmed:X,handleDeleteAll:T,handleCloseDeleteDialog:C,handleChangePage:F,handleChangeRowsPerPage:Y,handleEdit:J,handleAdd:c,handleAddConfirmed:re,handleEditConfirmed:ae}=$e(),[K,le]=a.useState([]),[oe,ie]=a.useState([]),[E,ne]=a.useState(null),de=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],[ce,ue]=a.useState([]),[he]=a.useState(H().startOf("day").hour(8)),[me]=a.useState(H().startOf("day").hour(9)),je=t=>{v(r=>({...r,start_time:t?t.format("HH:mm"):""}))},s=t=>{v(r=>({...r,end_time:t?t.format("HH:mm"):""}))},u=t=>{const r=t.hour();return r<8||r>18},Q=t=>{const r=t.hour();return r<9||r>18};a.useEffect(()=>{(async()=>{try{const r=await L.get("/admin/room/getroomlevel");ue(r.data.roomlevel)}catch(r){console.error("Error fetching room types:",r)}})()},[]),a.useEffect(()=>{E&&(async()=>{if(E)try{const r=await L.get(`/admin/room/getroomnumber/${E}`);ie(r.data)}catch(r){console.error("Error fetching room numbers:",r)}})()},[E]),a.useEffect(()=>{ye()},[]);const ye=async()=>{const t=await L.get("/admin/user/getteacherid");le(t.data)},[h,v]=a.useState({subject_id:"",day_of_week:"",start_time:"",end_time:"",room_id:""}),[Se,xe]=a.useState(!1),[ve,De]=a.useState([]),Z=()=>{xe(!1)},we=t=>{v({subject_id:t,day_of_week:"",start_time:"",end_time:"",room_id:""}),xe(!0)},Ae=async()=>{try{const t=await L.post("/class/addclass",{subject_id:h.subject_id,day_of_week:h.day_of_week,start_time:h.start_time,end_time:h.end_time,room_id:h.room_id}),r=t.data;t.status===201?(De([...ve,r.newClass]),Z(),v({subject_id:"",day_of_week:"",start_time:"",end_time:"",room_id:""}),g.success("Class added successfully")):(console.log("Error:",r.error),g.error(r.message)),await _()}catch(t){console.error("Error creating class:",t),g.error("Error data or room is not available for the new class")}};return e.jsx(e.Fragment,{children:e.jsxs(ze,{children:[e.jsxs(Fe,{children:[e.jsxs(Ee,{sx:{"--TableCell-height":"40px","--TableHeader-height":"calc(1 * var(--TableCell-height))","--Table-firstColumnWidth":"80px","--Table-lastColumnWidth":"144px","--TableRow-stripeBackground":"rgba(0 0 0 / 0.04)","--TableRow-hoverBackground":"rgba(0 0 0 / 0.08)",height:370,overflow:"auto",backgroundColor:"nav.bg"},children:[e.jsxs(Me,{className:"table mb-0",borderAxis:"bothBetween",stickyHeader:!0,hoverRow:!0,sx:{"--Table-headerUnderlineThickness":"1px","--TableCell-paddingX":"10px","--TableCell-paddingY":"7px","& tr > *:first-of-type":{position:"sticky",zIndex:1,left:0,boxShadow:"1px 0 var(--TableCell-borderColor)"},"& tr > *:last-child":{position:"sticky",right:0,bgcolor:"var(--TableCell-headBackground)"}},children:[e.jsxs(Le,{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:50},children:"No"}),e.jsx("th",{style:{width:100},children:"Name"}),e.jsx("th",{style:{width:100},children:"Code"}),e.jsx("th",{style:{width:100},children:"User"}),e.jsx("th",{style:{width:100},children:"Select"}),e.jsx("th",{style:{width:230},children:"Action"})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{children:e.jsx(_e,{checked:o,onChange:S,color:"primary",disabled:!1,size:"md"},"selectAllCheckbox")}),e.jsx("th",{})]})]}),e.jsx(He,{children:l.map((t,r)=>e.jsxs("tr",{className:"text-center",children:[e.jsx("th",{children:(q-1)*y+r+1}),e.jsx("th",{children:e.jsx(te,{title:t.subject_name,arrow:!0,children:e.jsx("span",{children:t.subject_name})})}),e.jsx("th",{children:e.jsx(te,{title:t.subject_code,arrow:!0,children:e.jsx("span",{children:t.subject_code})})}),e.jsx("th",{children:e.jsx(te,{title:t.firstname,arrow:!0,children:e.jsx("span",{children:t.firstname})})}),e.jsx("th",{children:e.jsx(_e,{checked:i.includes(t.subject_id),onChange:()=>k(t.subject_id),color:"primary",disabled:!1,size:"md"})}),e.jsx("th",{children:e.jsxs(Pe,{sx:{display:"flex",gap:1,justifyContent:"center",alignItems:"center"},children:[e.jsx(n,{variant:"solid",color:"warning",className:"edit",onClick:()=>J(t),children:"Edit"}),e.jsx(n,{color:"danger",variant:"solid",endDecorator:e.jsx(qe,{}),onClick:()=>j(t.subject_id),className:"delete",children:"Delete"}),e.jsx(n,{color:"primary",variant:"solid",endDecorator:e.jsx(Ce,{}),onClick:()=>we(t.subject_id),className:"create-class",children:"CreateClass"})]})})]},t.id||r))})]}),e.jsx(W,{open:D,onClose:C,children:e.jsxs(B,{variant:"outlined",role:"alertdialog",color:"danger",sx:{borderWidth:"3px"},children:[e.jsxs(M,{color:"danger",variant:"plain",level:"body-lg",children:[e.jsx(Ie,{}),"Confirmation"]}),e.jsx(Oe,{}),e.jsx(Ue,{children:i.length>1?"Are you sure you want to delete all selected subjects?":"Are you sure you want to delete the selected subject?"}),e.jsxs(U,{children:[e.jsx(n,{variant:"solid",color:"neutral",onClick:C,children:"Cancel"}),e.jsx(n,{variant:"solid",color:"danger",onClick:X,children:"Confirm Delete"})]})]})})]}),e.jsx("div",{className:"pagination-container",children:e.jsx(We,{count:100,page:q,rowsPerPage:y,onPageChange:F,onRowsPerPageChange:Y})})]}),e.jsx("div",{className:"card-footer",children:e.jsxs("div",{className:"this-btn d-flex justify-center align-center gap-2",children:[e.jsx(n,{sx:{width:"150px",padding:"15px !important",":hover":{boxShadow:"0 1px 20px 1px #A04C4C",border:"1px solid #A04C4C"}},id:"delete",color:"danger",variant:"solid",className:"text-red p-2",onClick:T,disabled:i.length===0,children:"Delete All"}),e.jsx(n,{sx:{width:"150px",padding:"15px !important",":hover":{boxShadow:"0 1px 20px 1px #0D6EFD",border:"1px solid #0D6EFD"}},id:"add",color:"primary",variant:"solid",className:" p-2",onClick:c,children:"Add"})]})}),e.jsx(W,{open:G,onClose:A,children:e.jsxs(B,{size:"lg",variant:"outlined",layout:"center",color:"primary",sx:{width:450},children:[e.jsx(M,{children:"Edit Subject"}),e.jsx("form",{onSubmit:t=>{t.preventDefault()},children:e.jsxs(ee,{spacing:3,children:[x&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"Number"}),e.jsx($,{autoFocus:!0,required:!0,name:"subject_name",value:x.subject_name,onChange:f,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"Code"}),e.jsx($,{required:!0,name:"subject_code",value:x.subject_code,onChange:f,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"User"}),e.jsx(N,{variant:"outlined",color:"primary",required:!0,name:"user_id",value:x.user_id,onChange:(t,r)=>V({...x,user_id:r}),size:"lg",children:K.map(t=>e.jsx(P,{value:t.id,children:t.firstname},t.id))})]})]}),e.jsxs(U,{children:[e.jsx(n,{type:"cancel",onClick:A,children:"Cancel"}),e.jsx(n,{type:"submit",onClick:ae,children:"Confirm"})]})]})})]})}),e.jsx(W,{open:I,onClose:z,children:e.jsxs(B,{size:"lg",variant:"outlined",layout:"center",color:"primary",sx:{width:450},children:[e.jsx(M,{children:"Add New Subject"}),e.jsx("form",{onSubmit:t=>{t.preventDefault()},children:e.jsxs(ee,{spacing:3,children:[e.jsxs(e.Fragment,{children:[e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"Name"}),e.jsx($,{autoFocus:!0,required:!0,name:"subject_name",value:b.subject_name,onChange:O,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"Code"}),e.jsx($,{required:!0,name:"subject_code",value:b.subject_code,onChange:O,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"User ID"}),e.jsx(N,{variant:"outlined",color:"primary",required:!0,name:"user_id",value:b.user_id,onChange:(t,r)=>w({...b,user_id:r}),size:"lg",children:K.map(t=>e.jsx(P,{value:t.id,children:t.firstname},t.id))})]})]}),e.jsxs(U,{children:[e.jsx(n,{type:"cancel",onClick:z,children:"Cancel"}),e.jsx(n,{type:"submit",onClick:re,children:"Confirm"})]})]})})]})}),e.jsx(W,{open:Se,onClose:Z,children:e.jsxs(B,{size:"lg",variant:"outlined",layout:"center",color:"primary",sx:{width:450},children:[e.jsx(M,{children:"Add New Subject"}),e.jsx("form",{onSubmit:t=>{t.preventDefault()},children:e.jsxs(ee,{spacing:3,children:[e.jsxs(e.Fragment,{children:[e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"ชั้น"}),e.jsx(N,{variant:"outlined",color:"primary",placeholder:"เลือกชั้น",onChange:(t,r)=>ne(r),children:ce.map(t=>e.jsx(P,{value:t,children:t},t))})]}),e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"Room"}),e.jsx(N,{variant:"outlined",color:"primary",required:!0,name:"room_id",value:h.room_id,onChange:(t,r)=>v({...h,room_id:r}),size:"lg",children:oe.map(t=>e.jsx(P,{value:t.room_id,children:t.room_number},t.room_id))})]}),e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"Day"}),e.jsx(N,{variant:"outlined",color:"primary",required:!0,name:"day_of_week",value:h.day_of_week,onChange:(t,r)=>v({...h,day_of_week:r}),size:"lg",children:de.map(t=>e.jsx(P,{value:t,children:t},t))})]}),e.jsx(m,{children:e.jsx(pe,{dateAdapter:be,adapterLocale:"th",children:e.jsx(ge,{sx:{width:"100%"},children:e.jsx(fe,{sx:{width:"100%"},className:"TimePicker",format:"HH:00",views:["hours"],value:he?H(h.start_time):null,onChange:je,shouldDisableTime:u})})})}),e.jsx(m,{children:e.jsx(pe,{dateAdapter:be,adapterLocale:"th",children:e.jsx(ge,{sx:{width:"100%"},children:e.jsx(fe,{sx:{width:"100%"},className:"TimePicker",format:"HH:00",views:["hours"],value:me?H(h.end_time):null,onChange:s,shouldDisableTime:Q})})})})]}),e.jsxs(U,{children:[e.jsx(n,{type:"cancel",onClick:Z,children:"Cancel"}),e.jsx(n,{type:"submit",onClick:Ae,children:"Confirm"})]})]})})]})})]})})};export{Dt as AddclassItem,wt as AddclassItemRes,At as default};
