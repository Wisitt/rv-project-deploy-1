import{r,Y as Ue,j as e,_ as Te,b as ke,$ as Ae,R as Q,U as F,G,S as Ee,p as Ne,B as j,y as de,a4 as ce}from"./index-bd07fbd0.js";import{d as Fe,a as Pe,D as Le}from"./WarningRounded-425b6d8a.js";import{T as qe,H as Re,a as We,b as Oe,c as O,C as Ve,V as he,O as ue}from"./Pagination-e67015c6.js";import{I,F as C}from"./FormControl-0effa5e0.js";import{C as me,T as Me}from"./Table-8b23f94b.js";import{M as Y}from"./Modal-47ea7b4d.js";import{M as X}from"./ModalDialog-cb89a8c8.js";import{s as Be,u as $e}from"./styled-ee573952.js";import{g as He,D as pe,a as J,F as y}from"./DialogActions-cb15ede7.js";import{D as Ge}from"./DialogContext-fbabc464.js";import{T as Ye}from"./Typography-40bc49a3.js";import{S as Xe}from"./Select-9b9debbb.js";import"./createSvgIcon-d571b62c.js";import"./ownerWindow-ac4bdde2.js";import"./useControlled-138fc601.js";import"./useEventCallback-469884d9.js";import"./FormControlContext-cf683adc.js";const Je=["className","id"],Ke=l=>{const{classes:i}=l;return Ae({root:["root"]},He,i)},Qe=Be(Ye,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(l,i)=>i.root})({padding:"16px 24px",flex:"0 0 auto"}),Ze=r.forwardRef(function(i,d){const o=$e({props:i,name:"MuiDialogTitle"}),{className:u,id:p}=o,_=Ue(o,Je),f=o,c=Ke(f),{titleId:m=p}=r.useContext(Ge);return e.jsx(Qe,Te({component:"h2",className:ke(c.root,u),ownerState:f,ref:d,variant:"h6",id:p??m},_))}),K=Ze,et=()=>{const[l,i]=r.useState({id:"",accountstatus:"",account_role:"",pin:"",citizen_id:"",firstname:"",lastname:"",account_type:"",user_img_path:null,updated:!1,imageFileName:""}),[d,o]=r.useState({id:"",user_name:"",citizen_id:"",reservation_id:"",room_id:"",user_id:"",start_date:"",end_date:"",reservation_status:""}),[u,p]=r.useState({id:"",pin:"",citizen_id:"",firstname:"",lastname:"",user_img_path:null,imageFileName:""}),[_,f]=r.useState({id:"",pin:"",citizen_id:"",firstname:"",lastname:"",account_type:"",user_img_path:null,imageFileName:""});return{user:l,editingUser:u,reservedUser:d,AddUser:_,setReservedUser:o,setAddUser:f,setEditUser:p,resetUser:()=>{i({id:"",accountstatus:"",account_role:"",pin:"",citizen_id:"",firstname:"",lastname:"",account_type:"",user_img_path:null,updated:!1,imageFileName:""})},setUser:i,handleInputChange:h=>{const{name:z,value:U}=h.target;f(b=>({...b,[z]:U}))},handleSelectChange:h=>{h&&f({..._,account_type:h.target.value})},handleInputEditChange:h=>{const{name:z,value:U}=h.target;p(b=>({...b,[z]:U}))}}},tt=(l,i)=>{const[d,o]=r.useState(l);return r.useEffect(()=>{const u=setTimeout(()=>{o(l)},i);return()=>{clearTimeout(u)}},[l,i]),d},st=()=>{const[l,i]=r.useState([]),[d,o]=r.useState(!1),[u,p]=r.useState([]),[_,f]=r.useState(1),[c,m]=r.useState(5),[V,S]=r.useState(!1),[h,z]=r.useState(null),[U,b]=r.useState(!1),[Z,T]=r.useState(!1),{user:ee,editingUser:w,AddUser:g,setEditUser:E,setAddUser:D,handleInputChange:te,handleSelectChange:se,resetUser:ae,handleInputEditChange:ne}=et(),[re,N]=r.useState(!1),[ie,P]=r.useState(!1),[M,B]=Q.useState(""),[L,q]=Q.useState(null),$=tt(M,500),R=t=>{i(n=>n.map(a=>a.id===t?{...a,updated:!0}:a))},k=r.useCallback(async t=>{if(t.trim()!==""){const n=await F.searchUsers(t);i(n)}else x()},[]);r.useEffect(()=>{k($)},[$,k]);const H=t=>{B(t.target.value)},x=r.useCallback(async()=>{const t=await F.getAllUsers({page:_,pageSize:c});i(t)},[_,c]);r.useEffect(()=>{},[x,k]);const le=()=>{T(!0),D({id:"",pin:"",citizen_id:"",firstname:"",lastname:"",account_type:"",user_img_path:null,imageFileName:""})},s=t=>{E(t),b(!0)},W=()=>{E(oe),b(!1)},ge=async()=>{if(w){const t=new FormData;t.append("pin",w.pin),t.append("citizen_id",w.citizen_id),t.append("firstname",w.firstname),t.append("lastname",w.lastname),L&&t.append("image",L);try{(await F.updateUser(w.id,t)).status===200&&E(oe),G.success("User updated successfully")}catch(n){console.error("Error updating user:",n),G.error("An error occurred while updating user")}R(w.id),b(!1),x()}},xe=()=>{T(!1),D({id:"",pin:"",citizen_id:"",firstname:"",lastname:"",account_type:"",user_img_path:null,imageFileName:""})},je=async()=>{if(!(g.pin.trim()!=="")){P(!0);return}if(P(!1),!(g.citizen_id.trim()!==""&&g.citizen_id.length===13)){N(!0);return}N(!1);const a=new FormData;a.append("pin",g.pin),a.append("citizen_id",g.citizen_id),a.append("firstname",g.firstname),a.append("lastname",g.lastname),a.append("account_type",g.account_type),a.append("image",L),console.log(a);try{await F.addUser(a),await x(),G.success("User added successfully"),T(!1),D({id:"",pin:"",citizen_id:"",firstname:"",lastname:"",account_type:"",user_img_path:null,imageFileName:""})}catch(v){console.error("Error adding user:",v),G.error("An error occurred while adding user")}},fe=t=>{const n=t.target.files;if(n&&n.length>0){const a=n[0],v=URL.createObjectURL(a);q(a),D(A=>({...A,user_img_path:v,imageFileName:a.name}))}},Ce=t=>{const n=t.target.files;if(n&&n.length>0){const a=n[0],v=URL.createObjectURL(a);q(a),E(A=>({...A,user_img_path:v,imageFileName:a.name}))}},ye=()=>{o(!d),p(d?[]:l.map(t=>t.id))},_e=t=>{p(n=>n.includes(t)?n.filter(a=>a!==t):[...n,t])},we=async t=>{await x(),z(t),S(!0)},De=async()=>{try{if(h!==null){await F.deactivateUser(h);const t=l.filter(n=>n.id!==h);i(t),z(null)}else{await Promise.all(u.map(async n=>{await F.deactivateUser(n)}));const t=l.filter(n=>!u.includes(n.id));i(t),p([])}await x()}catch(t){console.error("Error deactivating user(s):",t)}finally{S(!1)}},be=()=>{S(!0)},ve=()=>{S(!1)},Ie=async t=>{f(t),await x()},Se=async t=>{m(t),f(1),await x()},oe={id:"",pin:"",citizen_id:"",firstname:"",lastname:"",user_img_path:null,imageFileName:""};return{listItems:l,selectAll:d,selectedItems:u,page:_,rowsPerPage:c,deleteDialogOpen:V,itemToDelete:h,editDialogOpen:U,addDialogOpen:Z,user:ee,AddUser:g,editingUser:w,searchTerm:M,citizenIdError:re,pinIdError:ie,setAddUser:D,setSearchTerm:B,handleSearch:k,setEditUser:E,handleInputChange:te,handleInputChangeCitizen:t=>{const{name:n,value:a}=t.target,v=13,A=/^\d+$/.test(a)&&a.length<=v;(A||a==="")&&(N(!A),D(ze=>({...ze,[n]:a,useEffect:r.useEffect})))},handleInputChangePin:t=>{const{name:n,value:a}=t.target,v=a.trim()!=="";P(!v),D(A=>({...A,[n]:a}))},handleImageChange:fe,resetUser:ae,handleSelectChange:se,handleInputEditChange:ne,fetchUserList:x,handleAdd:le,handleEdit:s,handleCloseEditDialog:W,handleEditConfirmed:ge,handleCloseAddDialog:xe,handleAddConfirmed:je,handleSelectAll:ye,handleCheckboxChange:_e,handleDelete:we,handleDeleteConfirmed:De,handleDeleteAll:be,handleCloseDeleteDialog:ve,handleChangePage:Ie,handleChangeRowsPerPage:Se,markItemAsUpdated:R,handleChange:H,handleEditImageChange:Ce}},at=({searchTerm:l,handleChange:i,selectAll:d,handleSelectAll:o})=>e.jsxs(qe,{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:50},children:"No"}),e.jsx("th",{style:{width:80},children:"IMG"}),e.jsx("th",{style:{width:150},children:"FirstName"}),e.jsx("th",{style:{width:150},children:"LastName"}),e.jsx("th",{style:{width:200},children:"Student ID"}),e.jsx("th",{style:{width:200},children:"ID Card"}),e.jsx("th",{style:{width:150},children:"Account Type"}),e.jsx("th",{style:{width:100},children:"Actions"}),e.jsx("th",{style:{width:200},children:"Active"})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{colSpan:4,children:e.jsx(I,{disabled:!1,size:"md",placeholder:"Find data here...",variant:"outlined",value:l,onChange:i,color:"primary"})}),e.jsx("th",{}),e.jsx("th",{children:e.jsx(me,{checked:d,onChange:o,color:"primary",disabled:!1,size:"md"})}),e.jsx("th",{})]})]}),Dt=()=>{const{listItems:l,selectAll:i,selectedItems:d,page:o,rowsPerPage:u,deleteDialogOpen:p,editDialogOpen:_,addDialogOpen:f,AddUser:c,editingUser:m,searchTerm:V,citizenIdError:S,pinIdError:h,handleAddConfirmed:z,handleInputChange:U,handleInputChangeCitizen:b,handleInputChangePin:Z,handleInputEditChange:T,handleAdd:ee,handleEdit:w,handleCloseEditDialog:g,handleEditConfirmed:E,handleCloseAddDialog:D,handleSelectAll:te,handleCheckboxChange:se,handleDelete:ae,handleDeleteConfirmed:ne,handleDeleteAll:re,handleCloseDeleteDialog:N,handleChangePage:ie,handleChangeRowsPerPage:P,setAddUser:M,handleChange:B,handleImageChange:L,fetchUserList:q,handleEditImageChange:$}=st();r.useEffect(()=>{q()},[q,o,u]);const R=s=>({background:s.updated?"#197419":"",color:s.updated?"white":""}),[k,H]=Q.useState(null),[x,le]=Q.useState(null);return e.jsxs(Re,{children:[e.jsxs(We,{children:[e.jsxs(Ee,{sx:{"--TableCell-height":"40px","--TableHeader-height":"calc(1 * var(--TableCell-height))","--Table-firstColumnWidth":"80px","--Table-lastColumnWidth":"144px","--TableRow-stripeBackground":"rgba(0 0 0 / 0.04)","--TableRow-hoverBackground":"rgba(0 0 0 / 0.08)",height:385,overflow:"auto",backgroundColor:"nav.bg"},children:[e.jsxs(Me,{className:"table mb-0",borderAxis:"bothBetween",stickyHeader:!0,hoverRow:!0,sx:{"--Table-headerUnderlineThickness":"1px","--TableCell-paddingX":"10px","--TableCell-paddingY":"7px","& tr > *:first-of-type":{position:"sticky",zIndex:1,left:0,boxShadow:"1px 0 var(--TableCell-borderColor)"},"& tr > *:last-child":{position:"sticky",right:0,bgcolor:"var(--TableCell-headBackground)"}},children:[e.jsx(at,{searchTerm:V,handleChange:B,handleSelectAll:te,selectAll:i}),e.jsx(Oe,{children:l.map((s,W)=>e.jsxs("tr",{style:{borderRadius:s.updated?"10px":""},children:[e.jsx("th",{style:R(s),children:(o-1)*u+W+1}),e.jsx("th",{style:R(s),children:s.user_img_path!==null&&e.jsx("img",{style:{cursor:"pointer",display:"block",width:"50px",height:"50px",borderRadius:"50%"},src:`${s.user_img_path}?t=${new Date().toLocaleTimeString()} `,alt:`User ${s.id}`,width:"50",height:"50",onClick:()=>{H(`${s.user_img_path}?t=${new Date().toLocaleTimeString()}`),le(s)}})}),e.jsx("th",{children:e.jsx(O,{title:s.firstname,arrow:!0,children:e.jsx("span",{children:s.firstname})})}),e.jsx("th",{children:e.jsx(O,{title:s.lastname,arrow:!0,children:e.jsx("span",{children:s.lastname})})}),e.jsx("th",{children:e.jsx(O,{title:s.pin,arrow:!0,children:e.jsx("span",{children:s.pin})})}),e.jsx("th",{children:e.jsx(O,{title:s.citizen_id,arrow:!0,children:e.jsx("span",{children:s.citizen_id})})}),e.jsx("th",{children:e.jsx(O,{title:s.account_type,arrow:!0,children:e.jsx("span",{children:s.account_type})})}),e.jsx("th",{children:e.jsx(me,{checked:d.includes(s.id),onChange:()=>se(s.id),color:"primary",disabled:!1,size:"md"})}),e.jsx("th",{children:e.jsxs(Ne,{sx:{display:"flex",gap:1,justifyContent:"center",alignItems:"center"},children:[e.jsx(j,{variant:"solid",color:"warning",className:"edit",onClick:()=>{w(s)},children:"Edit"}),e.jsx(j,{color:"danger",variant:"solid",endDecorator:e.jsx(Fe,{}),onClick:()=>ae(s.id),className:"delete",children:"Delete"})]})})]},s.id))})]}),e.jsx(Y,{open:p,onClose:N,children:e.jsxs(X,{variant:"outlined",role:"alertdialog",sx:{width:"80%",maxWidth:400},children:[e.jsxs(K,{children:[e.jsx(Pe,{}),"Confirmation"]}),e.jsx(Le,{}),e.jsx(pe,{children:d.length>1?"Are you sure you want to deactivate all selected users?":"Are you sure you want to deactivate the selected user?"}),e.jsxs(J,{children:[e.jsx(j,{variant:"solid",color:"neutral",onClick:N,children:"Cancel"}),e.jsx(j,{variant:"solid",color:"danger",onClick:ne,children:"Confirm Delete"})]})]})})]}),e.jsx(Ve,{count:1e3,page:o,rowsPerPage:u,onPageChange:ie,onRowsPerPageChange:P})]}),e.jsx("div",{className:"card-footer",children:e.jsxs("div",{className:"this-btn d-flex justify-center align-center gap-2",children:[e.jsx(j,{sx:{width:"150px",padding:"15px !important",":hover":{boxShadow:"0 1px 20px 1px #A04C4C",border:"1px solid #A04C4C"}},id:"delete",color:"danger",variant:"solid",className:"text-red p-2",onClick:re,disabled:d.length===0,children:"Delete All"}),e.jsx(j,{sx:{width:"150px",padding:"15px !important",":hover":{boxShadow:"0 1px 20px 1px #0D6EFD",border:"1px solid #0D6EFD"}},id:"add",color:"primary",variant:"solid",className:" p-2",onClick:ee,children:"Add"})]})}),e.jsx(Y,{open:_,onClose:g,children:e.jsxs(X,{size:"lg",variant:"outlined",layout:"center",color:"primary",sx:{width:"80%",maxWidth:400},children:[e.jsx(K,{children:"Edit User"}),e.jsx("form",{onSubmit:s=>{s.preventDefault()},encType:"multipart/form-data",children:e.jsxs(de,{spacing:.5,direction:"column",justifyContent:"flex-start",children:[m&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx(y,{required:!0,children:"Student ID"}),e.jsx(I,{autoFocus:!0,required:!0,name:"pin",value:m.pin,onChange:T,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(C,{children:[e.jsx(y,{required:!0,children:"ID Card"}),e.jsx(I,{required:!0,name:"citizen_id",value:m.citizen_id,onChange:T,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(C,{children:[e.jsx(y,{required:!0,children:"FirstName"}),e.jsx(I,{required:!0,name:"firstname",value:m.firstname,onChange:T,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(C,{children:[e.jsx(y,{required:!0,children:"LastName"}),e.jsx(I,{required:!0,name:"lastname",value:m.lastname,onChange:T,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(C,{children:[e.jsx(y,{required:!0,children:"Upload New Image"}),e.jsxs(j,{component:"label",variant:"solid",color:"success",startDecorator:e.jsx(ce,{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z"})})}),children:["Upload a new image",e.jsx(he,{type:"file",name:"user_img_path",onChange:s=>$(s)})]})]}),m.user_img_path!==null&&e.jsxs("span",{children:["FileName : ",m.imageFileName]})]}),e.jsxs(J,{children:[e.jsx(j,{type:"cancel",onClick:g,children:"Cancel"}),e.jsx(j,{type:"submit",onClick:E,children:"Confirm"})]})]})})]})}),e.jsx(Y,{open:f,onClose:D,children:e.jsxs(X,{size:"lg",layout:"center",color:"primary",sx:{width:"80%",maxWidth:400},children:[e.jsx(K,{children:"Add New User"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault()},encType:"multipart/form-data",children:[e.jsx(de,{spacing:.5,direction:"column",justifyContent:"flex-start",children:e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx(y,{required:!0,children:"Student ID"}),e.jsx(I,{required:!0,error:h,name:"pin",value:c.pin,onChange:Z,fullWidth:!0,size:"lg",color:"primary"}),h&&e.jsx("p",{style:{color:"red"},children:"Citizen ID is required and must be valid."})]}),e.jsxs(C,{children:[e.jsx(y,{required:!0,children:"ID Card"}),e.jsx(I,{required:!0,error:S,name:"citizen_id",value:c.citizen_id,onChange:b,fullWidth:!0,size:"lg",color:"primary"}),S&&e.jsx("p",{style:{color:"red"},children:"Citizen ID is required and must be valid."})]}),e.jsxs(C,{children:[e.jsx(y,{required:!0,children:"FirstName"}),e.jsx(I,{required:!0,name:"firstname",value:c.firstname,onChange:U,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(C,{children:[e.jsx(y,{required:!0,children:"LastName"}),e.jsx(I,{required:!0,name:"lastname",value:c.lastname,onChange:U,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(C,{children:[e.jsx(y,{required:!0,children:"AccountType"}),e.jsxs(Xe,{defaultValue:"select",required:!0,color:"primary",variant:"outlined",name:"account_type",value:c.account_type,onChange:(s,W)=>M({...c,account_type:W}),children:[e.jsx(ue,{value:"student",children:"Student"}),e.jsx(ue,{value:"teacher",children:"Teacher"})]})]}),e.jsxs(C,{children:[e.jsx(y,{required:!0,children:"Upload"}),e.jsxs(j,{component:"label",role:void 0,tabIndex:-1,variant:"solid",color:"success",startDecorator:e.jsx(ce,{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z"})})}),children:["Upload a file",e.jsx(he,{type:"file",name:"user_img_path",onChange:L})]})]}),c.user_img_path!==null&&e.jsxs("span",{children:["FileName : ",c.imageFileName]})]})}),e.jsx(de,{children:e.jsxs(J,{children:[e.jsx(j,{type:"cancel",onClick:D,children:"Cancel"}),e.jsx(j,{type:"submit",onClick:z,children:"Confirm"})]})})]})]})}),e.jsx(Y,{open:!!k,onClose:()=>H(null),children:e.jsxs(X,{size:"lg",variant:"outlined",layout:"center",color:"primary",sx:{width:"80%",maxWidth:400},children:[e.jsx(K,{children:x&&x.firstname}),e.jsx(pe,{children:k&&e.jsx("img",{src:k,alt:"Full-size",style:{width:"20rem",height:"20rem"}})}),e.jsx(J,{})]})})]})};export{Dt as default};
