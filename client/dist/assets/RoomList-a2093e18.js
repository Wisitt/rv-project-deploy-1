import{r as l,a1 as K,G as le,j as e,S as ce,p as he,B as m,y as ie}from"./index-bd07fbd0.js";import{d as me,a as ue,D as xe}from"./WarningRounded-425b6d8a.js";import{H as pe,a as je,T as ge,b as fe,c as w,C as ye,O as j}from"./Pagination-e67015c6.js";import{R as k}from"./RoomService-c8fe411e.js";import{u as Ce}from"./useRoomState-ac6d5c61.js";import{T as _e,C as se}from"./Table-8b23f94b.js";import{M as V}from"./Modal-47ea7b4d.js";import{M as X}from"./ModalDialog-cb89a8c8.js";import{D as Y}from"./DialogTitle-138756e8.js";import{D as be,a as J,F as s}from"./DialogActions-cb15ede7.js";import{F as n,I as z}from"./FormControl-0effa5e0.js";import{S as y}from"./Select-9b9debbb.js";import{C as ne}from"./Chip-5cfc0777.js";import"./createSvgIcon-d571b62c.js";import"./styled-ee573952.js";import"./ownerWindow-ac4bdde2.js";import"./useControlled-138fc601.js";import"./useEventCallback-469884d9.js";import"./FormControlContext-cf683adc.js";import"./cardOverflowClasses-6b415049.js";const ve=()=>{const[C,_]=l.useState([]),[g,D]=l.useState(!1),[f,R]=l.useState([]),[i,d]=l.useState(1),[A,L]=l.useState(5),[O,b]=l.useState(!1),[P,x]=l.useState(!1),[v,q]=l.useState(null),[B,S]=l.useState(!1),[F,W]=l.useState([]),{room:H,editingRoom:a,AddRoom:I,setEditRoom:E,setAddRoom:M,handleInputChange:$,resetRoom:p,handleInputEditChange:N}=Ce(),c=l.useCallback(async()=>{try{const r=await k.getAllRoom({page:i,pageSize:A});_(r)}catch(r){console.error("Error fetching room response:",r)}},[i,A]),h=l.useCallback(async()=>{try{const r=await K.get("/admin/facility/getallfacility");W(r.data)}catch(r){console.error("Error fetching facilities:",r)}},[]);return{listItems:C,selectAll:g,facilities:F,selectedItems:f,page:i,rowsPerPage:A,deleteDialogOpen:P,itemToDelete:v,room:H,AddRoom:I,addDialogOpen:B,editingRoom:a,editDialogOpen:O,handleSelectAll:()=>{D(!g),R(g?[]:C.map(r=>r.room_id))},handleCloseEditDialog:()=>{E({id:"",room_id:"",room_number:"",room_type:"",room_capacity:"",room_facilities:[0,1],facilities_id:[1,2],room_level:"",room_status:""}),b(!1)},handleCloseAddDialog:()=>{S(!1)},setEditRoom:E,handleCheckboxChange:r=>{R(u=>u.includes(r)?u.filter(de=>de!==r):[...u,r])},handleInputChange:$,resetRoom:p,handleInputEditChange:N,fetchRoomList:c,handleDelete:async r=>{await c(),await h(),q(r),x(!0)},handleDeleteConfirmed:async()=>{try{if(v!==null){await k.deleteRoom(v);const r=C.filter(u=>u.room_id!==v);_(r),q(null)}else{await Promise.all(f.map(async u=>k.deleteRoom(u)));const r=C.filter(u=>!f.includes(u.room_id));_(r),R([])}await c(),await h(),x(!1)}catch(r){console.error("Error deactivating room(s):",r)}},handleDeleteAll:()=>{x(!0)},handleCloseDeleteDialog:()=>{x(!1)},handleChangePage:async r=>{d(r),await c(),await h()},handleChangeRowsPerPage:async r=>{L(r),d(1),await c(),await h()},handleEdit:r=>{E(r),b(!0)},handleAdd:()=>{p(),S(!0)},handleAddConfirmed:async()=>{try{const r=await k.addRoom(I);console.log("API Response:",r),S(!1),p(),await c(),await h(),window.location.reload(),le.success("Room added successfully")}catch(r){console.error("Error adding room:",r),le.error("Error adding room. Please try again.")}},handleEditConfirmed:async()=>{if(!(!a.room_number||!a.room_type||!a.room_capacity||!a.facilities_id||!a.room_level||!a.room_status)&&a)try{await k.updateRoom(a.room_id,{id:a.id,room_id:a.room_id,room_number:a.room_number,room_type:a.room_type,room_capacity:a.room_capacity,room_facilities:a.room_facilities,facilities_id:a.facilities_id,room_level:a.room_level,room_status:a.room_status}),console.log("Room updated successfully"),b(!1),await c(),await h()}catch(r){console.error("Error updating room:",r)}},fetchFacilities:h,setAddRoom:M,setListItems:_}},Ue=()=>{const{listItems:C,selectAll:_,selectedItems:g,page:D,rowsPerPage:f,deleteDialogOpen:R,editingRoom:i,AddRoom:d,editDialogOpen:A,addDialogOpen:L,handleAddConfirmed:O,handleCloseEditDialog:b,handleCloseAddDialog:P,handleInputChange:x,handleInputEditChange:v,handleSelectAll:q,handleCheckboxChange:B,handleDeleteConfirmed:S,handleCloseDeleteDialog:F,handleChangePage:W,handleChangeRowsPerPage:H,handleDelete:a,handleEdit:I,handleDeleteAll:E,handleAdd:M,handleEditConfirmed:$,setEditRoom:p,setAddRoom:N,fetchRoomList:c,fetchFacilities:h,facilities:G}=ve();l.useEffect(()=>{c(),h()},[c,h,D,f]);const Q=["ห้องเทส","ห้องปฎิบัติการ","ห้องประชุม"],[U,Z]=l.useState([]),[ee,oe]=l.useState([]),[T,re]=l.useState(null),[te,ae]=l.useState([]);return l.useEffect(()=>{(async()=>{try{const t=await K.get("/admin/room/getroomlevel");ae(t.data.roomlevel)}catch(t){console.error("Error fetching room types:",t)}})()},[]),l.useEffect(()=>{T&&(async()=>{if(T)try{const t=await K.get(`/admin/room/getroomnumber/${T}`);oe(t.data)}catch(t){console.error("Error fetching room numbers:",t)}})()},[T]),l.useEffect(()=>{Z(Q)},[]),e.jsxs(pe,{children:[e.jsxs(je,{children:[e.jsxs(ce,{sx:{"--TableCell-height":"40px","--TableHeader-height":"calc(1 * var(--TableCell-height))","--Table-firstColumnWidth":"80px","--Table-lastColumnWidth":"144px","--TableRow-stripeBackground":"rgba(0 0 0 / 0.04)","--TableRow-hoverBackground":"rgba(0 0 0 / 0.08)",height:375,overflow:"auto",backgroundColor:"nav.bg"},children:[e.jsxs(_e,{className:"table mb-0",borderAxis:"bothBetween",stickyHeader:!0,hoverRow:!0,sx:{"--Table-headerUnderlineThickness":"1px","--TableCell-paddingX":"10px","--TableCell-paddingY":"7px","& tr > *:first-of-type":{position:"sticky",zIndex:1,left:0,boxShadow:"1px 0 var(--TableCell-borderColor)"},"& tr > *:last-child":{position:"sticky",right:0,bgcolor:"var(--TableCell-headBackground)"}},children:[e.jsxs(ge,{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:50},children:"No"}),e.jsx("th",{style:{width:150},children:"Number"}),e.jsx("th",{style:{width:100},children:"Type"}),e.jsx("th",{style:{width:100},children:"Capacity"}),e.jsx("th",{style:{width:150},children:"Facilities"}),e.jsx("th",{style:{width:100},children:"Floor"}),e.jsx("th",{style:{width:150},children:"Status"}),e.jsx("th",{style:{width:100},children:"Actions"}),e.jsx("th",{style:{width:180},children:"Active"})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{children:e.jsx(se,{checked:_,onChange:q,color:"primary",disabled:!1,size:"md"},"selectAllCheckbox")}),e.jsx("th",{})]})]}),e.jsx(fe,{children:C.map((o,t)=>e.jsxs("tr",{className:"text-center",children:[e.jsx("th",{children:(D-1)*f+t+1}),e.jsx("th",{children:e.jsx(w,{title:o.room_number,arrow:!0,children:e.jsx("span",{children:o.room_number})})}),e.jsx("th",{children:e.jsx(w,{title:o.room_type,arrow:!0,children:e.jsx("span",{children:o.room_type})})}),e.jsx("th",{children:e.jsx(w,{title:o.room_capacity,arrow:!0,children:e.jsx("span",{children:o.room_capacity})})}),e.jsx("th",{children:e.jsx(w,{title:Array.isArray(o.room_facilities)?o.room_facilities.join(", "):o.room_facilities,arrow:!0,children:e.jsx("span",{children:Array.isArray(o.room_facilities)?o.room_facilities.join(", "):o.room_facilities})})}),e.jsx("th",{children:e.jsx(w,{title:o.room_level,arrow:!0,children:e.jsx("span",{children:o.room_level})})}),e.jsx("th",{children:e.jsx(w,{title:parseInt(o.room_status,10)===1?"ห้องใช้งานได้":"ห้องใช้งานไม่ได้",arrow:!0,children:e.jsx("span",{children:parseInt(o.room_status,10)===1?"ห้องใช้งานได้":"ห้องใช้งานไม่ได้"})})}),e.jsx("th",{children:e.jsx(se,{checked:g.includes(o.room_id),onChange:()=>B(o.room_id),color:"primary",disabled:!1,size:"md"})}),e.jsx("th",{children:e.jsxs(he,{sx:{display:"flex",gap:1,justifyContent:"center",alignItems:"center"},children:[e.jsx(m,{variant:"solid",color:"warning",className:"edit",onClick:()=>I(o),children:"Edit"}),e.jsx(m,{color:"danger",variant:"solid",endDecorator:e.jsx(me,{}),onClick:()=>a(o.room_id),className:"delete",children:"Delete"})]})})]},o.id||t))})]}),e.jsx(V,{open:R,onClose:F,children:e.jsxs(X,{variant:"outlined",role:"alertdialog",color:"danger",sx:{borderWidth:"3px"},children:[e.jsxs(Y,{color:"danger",variant:"plain",level:"body-lg",children:[e.jsx(ue,{}),"Confirmation"]}),e.jsx(xe,{}),e.jsx(be,{children:g.length>1?"Are you sure you want to delete all selected rooms?":"Are you sure you want to delete the selected room?"}),e.jsxs(J,{children:[e.jsx(m,{variant:"solid",color:"neutral",onClick:F,children:"Cancel"}),e.jsx(m,{variant:"solid",color:"danger",onClick:S,children:"Confirm Delete"})]})]})})]}),e.jsx("div",{className:"pagination-container",children:e.jsx(ye,{count:100,page:D,rowsPerPage:f,onPageChange:W,onRowsPerPageChange:H})})]}),e.jsx("div",{className:"card-footer",children:e.jsxs("div",{className:"this-btn d-flex justify-center align-center gap-2",children:[e.jsx(m,{sx:{width:"150px",padding:"15px !important",":hover":{boxShadow:"0 1px 20px 1px #A04C4C",border:"1px solid #A04C4C"}},id:"delete",color:"danger",variant:"solid",className:"text-red p-2",onClick:E,disabled:g.length===0,children:"Delete All"}),e.jsx(m,{sx:{width:"150px",padding:"15px !important",":hover":{boxShadow:"0 1px 20px 1px #0D6EFD",border:"1px solid #0D6EFD"}},id:"add",color:"primary",variant:"solid",className:" p-2",onClick:M,children:"Add"})]})}),e.jsx(V,{open:A,onClose:b,children:e.jsxs(X,{size:"lg",variant:"outlined",layout:"center",color:"primary",sx:{width:450},children:[e.jsx(Y,{children:"Edit Room"}),e.jsx("form",{onSubmit:o=>{o.preventDefault()},children:e.jsxs(ie,{spacing:3,children:[i&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{children:[e.jsx(s,{required:!0,children:"Floor"}),e.jsx(y,{variant:"outlined",color:"primary",placeholder:"เลือกชั้น",onChange:(o,t)=>re(t),children:te.map(o=>e.jsx(j,{value:o,children:o},o))})]}),e.jsxs(n,{children:[e.jsx(s,{required:!0,children:"Room"}),e.jsx(y,{required:!0,variant:"outlined",color:"primary",name:"room_id",value:i.room_id,onChange:(o,t)=>p({...i,room_id:t}),size:"lg",children:ee.map(o=>e.jsx(j,{value:o.room_id,children:o.room_number},o.room_id))})]}),e.jsxs(n,{children:[e.jsx(s,{required:!0,children:"Type"}),e.jsx(y,{variant:"outlined",color:"primary",required:!0,name:"room_type",value:i.room_type,sx:{width:"100%"},onChange:(o,t)=>p({...i,room_type:t}),children:U.map(o=>e.jsx(j,{value:o,children:o},o))})]}),e.jsxs(n,{children:[e.jsx(s,{required:!0,children:"Capacity"}),e.jsx(z,{required:!0,name:"room_capacity",value:i.room_capacity,onChange:v,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(n,{children:[e.jsx(s,{required:!0,children:"Facilities"}),e.jsx(y,{variant:"outlined",color:"primary",required:!0,name:"facilities_id",value:i.facilities_id,onChange:(o,t)=>p({...i,facilities_id:t}),multiple:!0,children:G.map(o=>e.jsx(j,{value:o.facility_id.toString(),children:o.facility_name},o.facility_id))})]}),e.jsxs(n,{children:[e.jsx(s,{required:!0,children:"Status"}),e.jsxs(y,{variant:"outlined",color:"primary",defaultValue:"select",required:!0,name:"room_status",value:i.room_status,onChange:(o,t)=>p({...i,room_status:t}),children:[e.jsx(j,{value:"0",children:e.jsx(ne,{color:"danger",variant:"outlined",children:"ห้องใช้งานไม่ได้"})}),e.jsx(j,{value:"1",children:e.jsx(ne,{color:"success",variant:"outlined",children:"ห้องใช้งานได้"})})]})]})]}),e.jsxs(J,{children:[e.jsx(m,{type:"cancel",onClick:b,children:"Cancel"}),e.jsx(m,{type:"submit",onClick:$,children:"Confirm"})]})]})})]})}),e.jsx(V,{open:L,onClose:P,children:e.jsxs(X,{size:"lg",variant:"outlined",layout:"center",color:"primary",sx:{width:450},children:[e.jsx(Y,{children:"Add New Room"}),e.jsx("form",{onSubmit:o=>{o.preventDefault()},children:e.jsxs(ie,{spacing:3,children:[e.jsxs(e.Fragment,{children:[e.jsxs(n,{children:[e.jsx(s,{required:!0,children:"Floor"}),e.jsx(z,{required:!0,name:"room_level",value:d.room_level,onChange:x,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(n,{children:[e.jsx(s,{required:!0,children:"Room"}),e.jsx(z,{required:!0,name:"room_number",value:d.room_number,onChange:x,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(n,{children:[e.jsx(s,{required:!0,children:"Type"}),e.jsx(y,{variant:"outlined",color:"primary",required:!0,name:"room_type",value:d.room_type,sx:{width:"100%"},onChange:(o,t)=>N({...d,room_type:t}),children:U.map(o=>e.jsx(j,{value:o,children:o},o))})]}),e.jsxs(n,{children:[e.jsx(s,{required:!0,children:"Capacity"}),e.jsx(z,{required:!0,name:"room_capacity",value:d.room_capacity,onChange:x,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(n,{children:[e.jsx(s,{required:!0,children:"Facilities"}),e.jsx(y,{variant:"outlined",color:"primary",required:!0,name:"facilities_id",value:d.facilities_id.map(String),onChange:(o,t)=>N({...d,facilities_id:t.map(Number)}),multiple:!0,children:G.map(o=>e.jsx(j,{value:o.facility_id.toString(),children:o.facility_name},o.facility_id))})]})]}),e.jsxs(J,{children:[e.jsx(m,{type:"cancel",onClick:P,children:"Cancel"}),e.jsx(m,{type:"submit",onClick:O,children:"Confirm"})]})]})})]})})]})};export{Ue as default};
