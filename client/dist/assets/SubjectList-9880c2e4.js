var ke=Object.defineProperty;var Te=(l,o,i)=>o in l?ke(l,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[o]=i;var n=(l,o,i)=>(Te(l,typeof o!="symbol"?o+"":o,i),i);import{r,F as g,j as e,a7 as L,S as Ee,o as Pe,B as d,x as ee}from"./index-d3b06103.js";import{r as Re,i as Ne,d as qe,a as Ie,D as Oe}from"./WarningRounded-5f4a2c99.js";import{H as ze,a as Fe,T as Le,b as He,c as se,C as We}from"./Pagination-f3ae1c4f.js";import{R as P}from"./RoomService-1dafd3c6.js";import{u as Be}from"./useRoomState-0544f6c5.js";import{Q as H,R as pe,U as be,W as ge,Y as fe}from"./TimePicker-5b263872.js";import{T as Me,C as _e}from"./Table-4da1d017.js";import{M as W,D as Ue,a as B}from"./DialogActions-313f809b.js";import{M}from"./ModalDialog-1b8aa38f.js";import{D as U}from"./DialogTitle-30adafd8.js";import{a as m,F as p,I as $}from"./FormLabel-09cbabd2.js";import{S as R,O as N}from"./Select-ca67cd63.js";import"./createSvgIcon-5dd918b6.js";import"./styled-cc5b2fa7.js";import"./ownerWindow-427e1a7c.js";import"./useControlled-c0ad3f19.js";import"./useEventCallback-0e03fb6b.js";import"./useMediaQuery-96d3f48e.js";import"./index-f6e3671f.js";import"./Typography-dc2989c6.js";import"./useFormControl-81508b3d.js";import"./Paper-119dbd57.js";import"./DialogContext-87782501.js";import"./cardOverflowClasses-8f8d0f9f.js";const $e=()=>{const[l,o]=r.useState([]),[i,q]=r.useState(!1),[y,w]=r.useState([]),[b,I]=r.useState(1),[x,Y]=r.useState(5),[Q,D]=r.useState(!1),[O,f]=r.useState(!1),[S,A]=r.useState(null),[z,k]=r.useState(!1),{AddSubject:_,editingSubject:j,subject:V,setSubject:T,setEditSubject:C,setAddSubject:F,handleInputChangeSubject:X,handleInputEditChangeSubject:G}=Be(),c=r.useCallback(async()=>{try{const t=await P.getAllSubject({page:b,pageSize:x});o(t)}catch(t){console.error("Error fetching subject response:",t)}},[b,x]);return r.useEffect(()=>{c()},[c]),{listItems:l,selectAll:i,selectedItems:y,page:b,rowsPerPage:x,deleteDialogOpen:O,itemToDelete:S,subject:V,AddSubject:_,addDialogOpen:z,editingSubject:j,editDialogOpen:Q,setSubject:T,setEditSubject:C,setAddSubject:F,handleInputChangeSubject:X,handleInputEditChangeSubject:G,handleSelectAll:()=>{q(!i),w(i?[]:l.map(t=>t.subject_id))},handleCloseEditDialog:()=>{C({id:"",subject_id:"",subject_name:"",subject_code:"",user_id:"",firstname:""}),D(!1)},handleCloseAddDialog:()=>{k(!1)},handleCheckboxChange:t=>{w(u=>u.includes(t)?u.filter(K=>K!==t):[...u,t])},fetchSubjectList:c,handleDelete:async t=>{await c(),A(t),f(!0)},handleDeleteConfirmed:async()=>{try{if(S!==null){await P.deleteSubject(S);const t=l.filter(u=>u.subject_id!==S);o(t),A(null),g.success("Subject deleted successfully")}else{await Promise.all(y.map(async u=>P.deleteSubject(u)));const t=l.filter(u=>!y.includes(u.subject_id));o(t),w([]),g.success("Subjects deleted successfully")}await c(),f(!1)}catch(t){console.error("Error deactivating subject(s):",t)}},handleDeleteAll:()=>{f(!0)},handleCloseDeleteDialog:()=>{f(!1)},handleChangePage:async t=>{I(t),await c()},handleChangeRowsPerPage:t=>{Y(t),I(1),c()},handleEdit:t=>{C(t),D(!0)},handleAdd:()=>{T({id:"",subject_id:"",subject_name:"",subject_code:"",user_id:"",firstname:""}),k(!0)},handleAddConfirmed:async()=>{if(!(!_.subject_name||!_.subject_code||!_.user_id)){try{const t=await P.addSubject(_);console.log("API Response:",t),await c(),k(!1),T({id:"",subject_id:"",subject_name:"",subject_code:"",user_id:"",firstname:""}),g.success("Subject add successfully:")}catch(t){console.error("Error adding subject:",t)}F({id:"",subject_id:"",subject_name:"",subject_code:"",user_id:"",firstname:""})}},handleEditConfirmed:async()=>{if(!(!j.subject_name||!j.subject_code||!j.user_id||!j.firstname)&&j){try{const t=await P.updateSubject(j.subject_id,{...j});t.status===200?C({id:"",subject_id:"",subject_name:"",subject_code:"",user_id:"",firstname:""}):g.error(t.data.message)}catch(t){console.error("Error updating subject:",t)}g.success("Subject updated successfully:"),await c(),D(!1)}}}};var te={},Ye=Ne;Object.defineProperty(te,"__esModule",{value:!0});var Ce=te.default=void 0,Qe=Ye(Re()),Ve=e,Xe=(0,Qe.default)((0,Ve.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");Ce=te.default=Xe;class Cs{constructor(){n(this,"subject_id");n(this,"day_of_week");n(this,"start_time");n(this,"end_time");n(this,"room_id")}}class ys{constructor(){n(this,"id");n(this,"subject_id");n(this,"day_of_week");n(this,"start_time");n(this,"end_time");n(this,"room_id")}}const Ss=()=>{const{listItems:l,selectAll:o,selectedItems:i,page:q,rowsPerPage:y,deleteDialogOpen:w,AddSubject:b,addDialogOpen:I,editingSubject:x,editDialogOpen:Y,setEditSubject:Q,setAddSubject:D,handleInputChangeSubject:O,handleInputEditChangeSubject:f,handleSelectAll:S,handleCloseEditDialog:A,handleCloseAddDialog:z,handleCheckboxChange:k,fetchSubjectList:_,handleDelete:j,handleDeleteConfirmed:V,handleDeleteAll:T,handleCloseDeleteDialog:C,handleChangePage:F,handleChangeRowsPerPage:X,handleEdit:G,handleAdd:c,handleAddConfirmed:ae,handleEditConfirmed:re}=$e(),[J,le]=r.useState([]),[oe,ie]=r.useState([]),[E,de]=r.useState(null),ne=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],[ce,ue]=r.useState([]),[he]=r.useState(H().startOf("day").hour(8)),[me]=r.useState(H().startOf("day").hour(9)),je=s=>{v(a=>({...a,start_time:s?s.format("HH:mm"):""}))},t=s=>{v(a=>({...a,end_time:s?s.format("HH:mm"):""}))},u=s=>{const a=s.hour();return a<8||a>18},K=s=>{const a=s.hour();return a<9||a>18};r.useEffect(()=>{(async()=>{try{const a=await L.get("/admin/room/getroomlevel");ue(a.data.roomlevel)}catch(a){console.error("Error fetching room types:",a)}})()},[]),r.useEffect(()=>{E&&(async()=>{if(E)try{const a=await L.get(`/admin/room/getroomnumber/${E}`);ie(a.data)}catch(a){console.error("Error fetching room numbers:",a)}})()},[E]),r.useEffect(()=>{ye()},[]);const ye=async()=>{const s=await L.get("/admin/user/getteacherid");le(s.data)},[h,v]=r.useState({subject_id:"",day_of_week:"",start_time:"",end_time:"",room_id:""}),[Se,xe]=r.useState(!1),[ve,we]=r.useState([]),Z=()=>{xe(!1)},De=s=>{v({subject_id:s,day_of_week:"",start_time:"",end_time:"",room_id:""}),xe(!0)},Ae=async()=>{try{const s=await L.post("/class/addclass",{subject_id:h.subject_id,day_of_week:h.day_of_week,start_time:h.start_time,end_time:h.end_time,room_id:h.room_id}),a=s.data;s.status===201?(we([...ve,a.newClass]),Z(),v({subject_id:"",day_of_week:"",start_time:"",end_time:"",room_id:""}),g.success("Class added successfully")):(console.log("Error:",a.error),g.error(a.message)),await _()}catch(s){console.error("Error creating class:",s),g.error("Error data or room is not available for the new class")}};return e.jsx(e.Fragment,{children:e.jsxs(ze,{children:[e.jsxs(Fe,{children:[e.jsxs(Ee,{sx:{"--TableCell-height":"40px","--TableHeader-height":"calc(1 * var(--TableCell-height))","--Table-firstColumnWidth":"80px","--Table-lastColumnWidth":"144px","--TableRow-stripeBackground":"rgba(0 0 0 / 0.04)","--TableRow-hoverBackground":"rgba(0 0 0 / 0.08)",height:370,overflow:"auto",backgroundColor:"nav.bg"},children:[e.jsxs(Me,{className:"table mb-0",borderAxis:"bothBetween",stickyHeader:!0,hoverRow:!0,sx:{"--Table-headerUnderlineThickness":"1px","--TableCell-paddingX":"10px","--TableCell-paddingY":"7px","& tr > *:first-of-type":{position:"sticky",zIndex:1,left:0,boxShadow:"1px 0 var(--TableCell-borderColor)"},"& tr > *:last-child":{position:"sticky",right:0,bgcolor:"var(--TableCell-headBackground)"}},children:[e.jsxs(Le,{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:50},children:"No"}),e.jsx("th",{style:{width:100},children:"Name"}),e.jsx("th",{style:{width:100},children:"Code"}),e.jsx("th",{style:{width:100},children:"User"}),e.jsx("th",{style:{width:100},children:"Select"}),e.jsx("th",{style:{width:230},children:"Action"})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{children:e.jsx(_e,{checked:o,onChange:S,color:"primary",disabled:!1,size:"md"},"selectAllCheckbox")}),e.jsx("th",{})]})]}),e.jsx(He,{children:l.map((s,a)=>e.jsxs("tr",{className:"text-center",children:[e.jsx("th",{children:(q-1)*y+a+1}),e.jsx("th",{children:e.jsx(se,{title:s.subject_name,arrow:!0,children:e.jsx("span",{children:s.subject_name})})}),e.jsx("th",{children:e.jsx(se,{title:s.subject_code,arrow:!0,children:e.jsx("span",{children:s.subject_code})})}),e.jsx("th",{children:e.jsx(se,{title:s.firstname,arrow:!0,children:e.jsx("span",{children:s.firstname})})}),e.jsx("th",{children:e.jsx(_e,{checked:i.includes(s.subject_id),onChange:()=>k(s.subject_id),color:"primary",disabled:!1,size:"md"})}),e.jsx("th",{children:e.jsxs(Pe,{sx:{display:"flex",gap:1,justifyContent:"center",alignItems:"center"},children:[e.jsx(d,{variant:"solid",color:"warning",className:"edit",onClick:()=>G(s),children:"Edit"}),e.jsx(d,{color:"danger",variant:"solid",endDecorator:e.jsx(qe,{}),onClick:()=>j(s.subject_id),className:"delete",children:"Delete"}),e.jsx(d,{color:"primary",variant:"solid",endDecorator:e.jsx(Ce,{}),onClick:()=>De(s.subject_id),className:"create-class",children:"CreateClass"})]})})]},s.id||a))})]}),e.jsx(W,{open:w,onClose:C,children:e.jsxs(M,{variant:"outlined",role:"alertdialog",color:"danger",sx:{borderWidth:"3px"},children:[e.jsxs(U,{color:"danger",variant:"plain",level:"body-lg",children:[e.jsx(Ie,{}),"Confirmation"]}),e.jsx(Oe,{}),e.jsx(Ue,{children:i.length>1?"Are you sure you want to delete all selected subjects?":"Are you sure you want to delete the selected subject?"}),e.jsxs(B,{children:[e.jsx(d,{variant:"solid",color:"neutral",onClick:C,children:"Cancel"}),e.jsx(d,{variant:"solid",color:"danger",onClick:V,children:"Confirm Delete"})]})]})})]}),e.jsx("div",{className:"pagination-container",children:e.jsx(We,{count:100,page:q,rowsPerPage:y,onPageChange:F,onRowsPerPageChange:X})})]}),e.jsx("div",{className:"card-footer",children:e.jsxs("div",{className:"this-btn d-flex justify-center align-center gap-2",children:[e.jsx(d,{sx:{width:"150px",padding:"15px !important",":hover":{boxShadow:"0 1px 20px 1px #A04C4C",border:"1px solid #A04C4C"}},id:"delete",color:"danger",variant:"solid",className:"text-red p-2",onClick:T,disabled:i.length===0,children:"Delete All"}),e.jsx(d,{sx:{width:"150px",padding:"15px !important",":hover":{boxShadow:"0 1px 20px 1px #0D6EFD",border:"1px solid #0D6EFD"}},id:"add",color:"primary",variant:"solid",className:" p-2",onClick:c,children:"Add"})]})}),e.jsx(W,{open:Y,onClose:A,children:e.jsxs(M,{size:"lg",variant:"outlined",layout:"center",color:"primary",sx:{width:450},children:[e.jsx(U,{children:"Edit Subject"}),e.jsx("form",{onSubmit:s=>{s.preventDefault()},children:e.jsxs(ee,{spacing:3,children:[x&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"Number"}),e.jsx($,{autoFocus:!0,required:!0,name:"subject_name",value:x.subject_name,onChange:f,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"Code"}),e.jsx($,{required:!0,name:"subject_code",value:x.subject_code,onChange:f,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"User"}),e.jsx(R,{variant:"solid",color:"primary",required:!0,name:"user_id",value:x.user_id,onChange:(s,a)=>Q({...x,user_id:a}),size:"lg",children:J.map(s=>e.jsx(N,{value:s.id,children:s.firstname},s.id))})]})]}),e.jsxs(B,{children:[e.jsx(d,{type:"cancel",onClick:A,children:"Cancel"}),e.jsx(d,{type:"submit",onClick:re,children:"Confirm"})]})]})})]})}),e.jsx(W,{open:I,onClose:z,children:e.jsxs(M,{size:"lg",variant:"outlined",layout:"center",color:"primary",sx:{width:450},children:[e.jsx(U,{children:"Add New Subject"}),e.jsx("form",{onSubmit:s=>{s.preventDefault()},children:e.jsxs(ee,{spacing:3,children:[e.jsxs(e.Fragment,{children:[e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"Name"}),e.jsx($,{autoFocus:!0,required:!0,name:"subject_name",value:b.subject_name,onChange:O,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"Code"}),e.jsx($,{required:!0,name:"subject_code",value:b.subject_code,onChange:O,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"User ID"}),e.jsx(R,{variant:"solid",color:"primary",required:!0,name:"user_id",value:b.user_id,onChange:(s,a)=>D({...b,user_id:a}),size:"lg",children:J.map(s=>e.jsx(N,{value:s.id,children:s.firstname},s.id))})]})]}),e.jsxs(B,{children:[e.jsx(d,{type:"cancel",onClick:z,children:"Cancel"}),e.jsx(d,{type:"submit",onClick:ae,children:"Confirm"})]})]})})]})}),e.jsx(W,{open:Se,onClose:Z,children:e.jsxs(M,{size:"lg",variant:"outlined",layout:"center",color:"primary",sx:{width:450},children:[e.jsx(U,{children:"Add New Subject"}),e.jsx("form",{onSubmit:s=>{s.preventDefault()},children:e.jsxs(ee,{spacing:3,children:[e.jsxs(e.Fragment,{children:[e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"ชั้น"}),e.jsx(R,{variant:"solid",color:"primary",placeholder:"เลือกชั้น",onChange:(s,a)=>de(a),children:ce.map(s=>e.jsx(N,{value:s,children:s},s))})]}),e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"Room"}),e.jsx(R,{variant:"solid",color:"primary",required:!0,name:"room_id",value:h.room_id,onChange:(s,a)=>v({...h,room_id:a}),size:"lg",children:oe.map(s=>e.jsx(N,{value:s.room_id,children:s.room_number},s.room_id))})]}),e.jsxs(m,{children:[e.jsx(p,{required:!0,children:"Day"}),e.jsx(R,{variant:"solid",color:"primary",required:!0,name:"day_of_week",value:h.day_of_week,onChange:(s,a)=>v({...h,day_of_week:a}),size:"lg",children:ne.map(s=>e.jsx(N,{value:s,children:s},s))})]}),e.jsx(m,{children:e.jsx(pe,{dateAdapter:be,adapterLocale:"th",children:e.jsx(ge,{sx:{width:"100%"},children:e.jsx(fe,{sx:{width:"100%"},className:"TimePicker",format:"HH:00",views:["hours"],value:he?H(h.start_time):null,onChange:je,shouldDisableTime:u})})})}),e.jsx(m,{children:e.jsx(pe,{dateAdapter:be,adapterLocale:"th",children:e.jsx(ge,{sx:{width:"100%"},children:e.jsx(fe,{sx:{width:"100%"},className:"TimePicker",format:"HH:00",views:["hours"],value:me?H(h.end_time):null,onChange:t,shouldDisableTime:K})})})})]}),e.jsxs(B,{children:[e.jsx(d,{type:"cancel",onClick:Z,children:"Cancel"}),e.jsx(d,{type:"submit",onClick:Ae,children:"Confirm"})]})]})})]})})]})})};export{Cs as AddclassItem,ys as AddclassItemRes,Ss as default};
