import{r as l,a7 as L,j as e,S as ne,o as de,B as m,x as ae}from"./index-d3b06103.js";import{d as ce,a as he,D as me}from"./WarningRounded-5f4a2c99.js";import{H as ue,a as xe,T as pe,b as je,c as v,C as ge}from"./Pagination-f3ae1c4f.js";import{R as k}from"./RoomService-1dafd3c6.js";import{u as fe}from"./useRoomState-0544f6c5.js";import{T as ye,C as le}from"./Table-4da1d017.js";import{M as Y,D as Ce,a as G}from"./DialogActions-313f809b.js";import{M as J}from"./ModalDialog-1b8aa38f.js";import{D as K}from"./DialogTitle-30adafd8.js";import{a as s,F as n,I as z}from"./FormLabel-09cbabd2.js";import{S as y,O as j}from"./Select-ca67cd63.js";import{C as ie}from"./Chip-61747c2a.js";import"./createSvgIcon-5dd918b6.js";import"./styled-cc5b2fa7.js";import"./ownerWindow-427e1a7c.js";import"./useControlled-c0ad3f19.js";import"./useEventCallback-0e03fb6b.js";import"./cardOverflowClasses-8f8d0f9f.js";const _e=()=>{const[C,w]=l.useState([]),[g,D]=l.useState(!1),[f,R]=l.useState([]),[i,d]=l.useState(1),[A,O]=l.useState(5),[B,_]=l.useState(!1),[P,x]=l.useState(!1),[b,q]=l.useState(null),[W,S]=l.useState(!1),[F,H]=l.useState([]),{room:M,editingRoom:a,AddRoom:I,setEditRoom:E,setAddRoom:$,handleInputChange:U,resetRoom:p,handleInputEditChange:N}=fe(),c=l.useCallback(async()=>{try{const r=await k.getAllRoom({page:i,pageSize:A});w(r)}catch(r){console.error("Error fetching room response:",r)}},[i,A]),h=l.useCallback(async()=>{try{const r=await L.get("/admin/facility/getallfacility");H(r.data)}catch(r){console.error("Error fetching facilities:",r)}},[]);return{listItems:C,selectAll:g,facilities:F,selectedItems:f,page:i,rowsPerPage:A,deleteDialogOpen:P,itemToDelete:b,room:M,AddRoom:I,addDialogOpen:W,editingRoom:a,editDialogOpen:B,handleSelectAll:()=>{D(!g),R(g?[]:C.map(r=>r.room_id))},handleCloseEditDialog:()=>{E({id:"",room_id:"",room_number:"",room_type:"",room_capacity:"",room_facilities:[0,1],facilities_id:[1,2],room_level:"",room_status:""}),_(!1)},handleCloseAddDialog:()=>{S(!1)},setEditRoom:E,handleCheckboxChange:r=>{R(u=>u.includes(r)?u.filter(se=>se!==r):[...u,r])},handleInputChange:U,resetRoom:p,handleInputEditChange:N,fetchRoomList:c,handleDelete:async r=>{await c(),await h(),q(r),x(!0)},handleDeleteConfirmed:async()=>{try{if(b!==null){await k.deleteRoom(b);const r=C.filter(u=>u.room_id!==b);w(r),q(null)}else{await Promise.all(f.map(async u=>k.deleteRoom(u)));const r=C.filter(u=>!f.includes(u.room_id));w(r),R([])}await c(),await h(),x(!1)}catch(r){console.error("Error deactivating room(s):",r)}},handleDeleteAll:()=>{x(!0)},handleCloseDeleteDialog:()=>{x(!1)},handleChangePage:async r=>{d(r),await c(),await h()},handleChangeRowsPerPage:async r=>{O(r),d(1),await c(),await h()},handleEdit:r=>{E(r),_(!0)},handleAdd:()=>{p(),S(!0)},handleAddConfirmed:async()=>{try{const r=await k.addRoom(I);console.log("API Response:",r),S(!1),p(),await c(),await h(),window.location.reload()}catch(r){console.error("Error adding room:",r)}},handleEditConfirmed:async()=>{if(!(!a.room_number||!a.room_type||!a.room_capacity||!a.facilities_id||!a.room_level||!a.room_status)&&a)try{await k.updateRoom(a.room_id,{id:a.id,room_id:a.room_id,room_number:a.room_number,room_type:a.room_type,room_capacity:a.room_capacity,room_facilities:a.room_facilities,facilities_id:a.facilities_id,room_level:a.room_level,room_status:a.room_status}),console.log("Room updated successfully"),_(!1),await c(),await h()}catch(r){console.error("Error updating room:",r)}},fetchFacilities:h,setAddRoom:$}},Me=()=>{const{listItems:C,selectAll:w,selectedItems:g,page:D,rowsPerPage:f,deleteDialogOpen:R,editingRoom:i,AddRoom:d,editDialogOpen:A,addDialogOpen:O,handleAddConfirmed:B,handleCloseEditDialog:_,handleCloseAddDialog:P,handleInputChange:x,handleInputEditChange:b,handleSelectAll:q,handleCheckboxChange:W,handleDeleteConfirmed:S,handleCloseDeleteDialog:F,handleChangePage:H,handleChangeRowsPerPage:M,handleDelete:a,handleEdit:I,handleDeleteAll:E,handleAdd:$,handleEditConfirmed:U,setEditRoom:p,setAddRoom:N,fetchRoomList:c,fetchFacilities:h,facilities:V}=_e();l.useEffect(()=>{c(),h()},[c,h,D,f]);const[X,Q]=l.useState([]),[Z,ee]=l.useState([]),[T,oe]=l.useState(null),[re,te]=l.useState([]);return l.useEffect(()=>{(async()=>{try{const t=await L.get("/admin/room/getroomlevel");te(t.data.roomlevel)}catch(t){console.error("Error fetching room types:",t)}})()},[]),l.useEffect(()=>{T&&(async()=>{if(T)try{const t=await L.get(`/admin/room/getroomnumber/${T}`);ee(t.data)}catch(t){console.error("Error fetching room numbers:",t)}})()},[T]),l.useEffect(()=>{(async()=>{try{const t=await L.get("/admin/room/getroomtype/{roomtype_id}");Q(t.data.room_types)}catch(t){console.error("Error fetching room types:",t)}})()},[]),e.jsxs(ue,{children:[e.jsxs(xe,{children:[e.jsxs(ne,{sx:{"--TableCell-height":"40px","--TableHeader-height":"calc(1 * var(--TableCell-height))","--Table-firstColumnWidth":"80px","--Table-lastColumnWidth":"144px","--TableRow-stripeBackground":"rgba(0 0 0 / 0.04)","--TableRow-hoverBackground":"rgba(0 0 0 / 0.08)",height:375,overflow:"auto",backgroundColor:"nav.bg"},children:[e.jsxs(ye,{className:"table mb-0",borderAxis:"bothBetween",stickyHeader:!0,hoverRow:!0,sx:{"--Table-headerUnderlineThickness":"1px","--TableCell-paddingX":"10px","--TableCell-paddingY":"7px","& tr > *:first-of-type":{position:"sticky",zIndex:1,left:0,boxShadow:"1px 0 var(--TableCell-borderColor)"},"& tr > *:last-child":{position:"sticky",right:0,bgcolor:"var(--TableCell-headBackground)"}},children:[e.jsxs(pe,{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:50},children:"No"}),e.jsx("th",{style:{width:150},children:"Number"}),e.jsx("th",{style:{width:100},children:"Type"}),e.jsx("th",{style:{width:100},children:"Capacity"}),e.jsx("th",{style:{width:150},children:"Facilities"}),e.jsx("th",{style:{width:100},children:"Floor"}),e.jsx("th",{style:{width:150},children:"Status"}),e.jsx("th",{style:{width:100},children:"Actions"}),e.jsx("th",{style:{width:180},children:"Active"})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{children:e.jsx(le,{checked:w,onChange:q,color:"primary",disabled:!1,size:"md"},"selectAllCheckbox")}),e.jsx("th",{})]})]}),e.jsx(je,{children:C.map((o,t)=>e.jsxs("tr",{className:"text-center",children:[e.jsx("th",{children:(D-1)*f+t+1}),e.jsx("th",{children:e.jsx(v,{title:o.room_number,arrow:!0,children:e.jsx("span",{children:o.room_number})})}),e.jsx("th",{children:e.jsx(v,{title:o.room_type,arrow:!0,children:e.jsx("span",{children:o.room_type})})}),e.jsx("th",{children:e.jsx(v,{title:o.room_capacity,arrow:!0,children:e.jsx("span",{children:o.room_capacity})})}),e.jsx("th",{children:e.jsx(v,{title:Array.isArray(o.room_facilities)?o.room_facilities.join(", "):o.room_facilities,arrow:!0,children:e.jsx("span",{children:Array.isArray(o.room_facilities)?o.room_facilities.join(", "):o.room_facilities})})}),e.jsx("th",{children:e.jsx(v,{title:o.room_level,arrow:!0,children:e.jsx("span",{children:o.room_level})})}),e.jsx("th",{children:e.jsx(v,{title:parseInt(o.room_status,10)===1?"ห้องใช้งานได้":"ห้องใช้งานไม่ได้",arrow:!0,children:e.jsx("span",{children:parseInt(o.room_status,10)===1?"ห้องใช้งานได้":"ห้องใช้งานไม่ได้"})})}),e.jsx("th",{children:e.jsx(le,{checked:g.includes(o.room_id),onChange:()=>W(o.room_id),color:"primary",disabled:!1,size:"md"})}),e.jsx("th",{children:e.jsxs(de,{sx:{display:"flex",gap:1,justifyContent:"center",alignItems:"center"},children:[e.jsx(m,{variant:"solid",color:"warning",className:"edit",onClick:()=>I(o),children:"Edit"}),e.jsx(m,{color:"danger",variant:"solid",endDecorator:e.jsx(ce,{}),onClick:()=>a(o.room_id),className:"delete",children:"Delete"})]})})]},o.id||t))})]}),e.jsx(Y,{open:R,onClose:F,children:e.jsxs(J,{variant:"outlined",role:"alertdialog",color:"danger",sx:{borderWidth:"3px"},children:[e.jsxs(K,{color:"danger",variant:"plain",level:"body-lg",children:[e.jsx(he,{}),"Confirmation"]}),e.jsx(me,{}),e.jsx(Ce,{children:g.length>1?"Are you sure you want to delete all selected rooms?":"Are you sure you want to delete the selected room?"}),e.jsxs(G,{children:[e.jsx(m,{variant:"solid",color:"neutral",onClick:F,children:"Cancel"}),e.jsx(m,{variant:"solid",color:"danger",onClick:S,children:"Confirm Delete"})]})]})})]}),e.jsx("div",{className:"pagination-container",children:e.jsx(ge,{count:100,page:D,rowsPerPage:f,onPageChange:H,onRowsPerPageChange:M})})]}),e.jsx("div",{className:"card-footer",children:e.jsxs("div",{className:"this-btn d-flex justify-center align-center gap-2",children:[e.jsx(m,{sx:{width:"150px",padding:"15px !important",":hover":{boxShadow:"0 1px 20px 1px #A04C4C",border:"1px solid #A04C4C"}},id:"delete",color:"danger",variant:"solid",className:"text-red p-2",onClick:E,disabled:g.length===0,children:"Delete All"}),e.jsx(m,{sx:{width:"150px",padding:"15px !important",":hover":{boxShadow:"0 1px 20px 1px #0D6EFD",border:"1px solid #0D6EFD"}},id:"add",color:"primary",variant:"solid",className:" p-2",onClick:$,children:"Add"})]})}),e.jsx(Y,{open:A,onClose:_,children:e.jsxs(J,{size:"lg",variant:"outlined",layout:"center",color:"primary",sx:{width:450},children:[e.jsx(K,{children:"Edit Room"}),e.jsx("form",{onSubmit:o=>{o.preventDefault()},children:e.jsxs(ae,{spacing:3,children:[i&&e.jsxs(e.Fragment,{children:[e.jsxs(s,{children:[e.jsx(n,{required:!0,children:"Floor"}),e.jsx(y,{variant:"solid",color:"primary",placeholder:"เลือกชั้น",onChange:(o,t)=>oe(t),children:re.map(o=>e.jsx(j,{value:o,children:o},o))})]}),e.jsxs(s,{children:[e.jsx(n,{required:!0,children:"Room"}),e.jsx(y,{required:!0,variant:"solid",color:"primary",name:"room_id",value:i.room_id,onChange:(o,t)=>p({...i,room_id:t}),size:"lg",children:Z.map(o=>e.jsx(j,{value:o.room_id,children:o.room_number},o.room_id))})]}),e.jsxs(s,{children:[e.jsx(n,{required:!0,children:"Type"}),e.jsx(y,{variant:"solid",color:"primary",required:!0,name:"room_type",value:i.room_type,sx:{width:"100%"},onChange:(o,t)=>p({...i,room_type:t}),children:X.map(o=>e.jsx(j,{value:o,children:o},o))})]}),e.jsxs(s,{children:[e.jsx(n,{required:!0,children:"Capacity"}),e.jsx(z,{required:!0,name:"room_capacity",value:i.room_capacity,onChange:b,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(s,{children:[e.jsx(n,{required:!0,children:"Facilities"}),e.jsx(y,{variant:"solid",color:"primary",required:!0,name:"facilities_id",value:i.facilities_id,onChange:(o,t)=>p({...i,facilities_id:t}),multiple:!0,children:V.map(o=>e.jsx(j,{value:o.facility_id.toString(),children:o.facility_name},o.facility_id))})]}),e.jsxs(s,{children:[e.jsx(n,{required:!0,children:"Status"}),e.jsxs(y,{variant:"solid",color:"primary",defaultValue:"select",required:!0,name:"room_status",value:i.room_status,onChange:(o,t)=>p({...i,room_status:t}),children:[e.jsx(j,{value:"0",children:e.jsx(ie,{color:"danger",variant:"solid",children:"ห้องใช้งานไม่ได้"})}),e.jsx(j,{value:"1",children:e.jsx(ie,{color:"success",variant:"solid",children:"ห้องใช้งานได้"})})]})]})]}),e.jsxs(G,{children:[e.jsx(m,{type:"cancel",onClick:_,children:"Cancel"}),e.jsx(m,{type:"submit",onClick:U,children:"Confirm"})]})]})})]})}),e.jsx(Y,{open:O,onClose:P,children:e.jsxs(J,{size:"lg",variant:"outlined",layout:"center",color:"primary",sx:{width:450},children:[e.jsx(K,{children:"Add New Room"}),e.jsx("form",{onSubmit:o=>{o.preventDefault()},children:e.jsxs(ae,{spacing:3,children:[e.jsxs(e.Fragment,{children:[e.jsxs(s,{children:[e.jsx(n,{required:!0,children:"Floor"}),e.jsx(z,{required:!0,name:"room_level",value:d.room_level,onChange:x,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(s,{children:[e.jsx(n,{required:!0,children:"Room"}),e.jsx(z,{required:!0,name:"room_number",value:d.room_number,onChange:x,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(s,{children:[e.jsx(n,{required:!0,children:"Type"}),e.jsx(y,{variant:"solid",color:"primary",required:!0,name:"room_type",value:d.room_type,sx:{width:"100%"},onChange:(o,t)=>N({...d,room_type:t}),children:X.map(o=>e.jsx(j,{value:o,children:o},o))})]}),e.jsxs(s,{children:[e.jsx(n,{required:!0,children:"Capacity"}),e.jsx(z,{required:!0,name:"room_capacity",value:d.room_capacity,onChange:x,fullWidth:!0,size:"lg",color:"primary"})]}),e.jsxs(s,{children:[e.jsx(n,{required:!0,children:"Facilities"}),e.jsx(y,{variant:"solid",color:"primary",required:!0,name:"facilities_id",value:d.facilities_id.map(String),onChange:(o,t)=>N({...d,facilities_id:t.map(Number)}),multiple:!0,children:V.map(o=>e.jsx(j,{value:o.facility_id.toString(),children:o.facility_name},o.facility_id))})]})]}),e.jsxs(G,{children:[e.jsx(m,{type:"cancel",onClick:P,children:"Cancel"}),e.jsx(m,{type:"submit",onClick:B,children:"Confirm"})]})]})})]})})]})};export{Me as default};
