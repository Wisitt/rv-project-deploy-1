import{r as l,R as I,a1 as P,G as H,j as e,C as $,S as W,T as U,B as A}from"./index-bd07fbd0.js";import{O as S,D as X,H as q,a as J,T as K,b as Q,c as x,C as V}from"./Pagination-e67015c6.js";import{R as Z}from"./RoomService-c8fe411e.js";import{L as ee,A as te}from"./useMobilePicker-f4f29c97.js";import{G as k}from"./Grid-cc899c58.js";import{F as L}from"./DialogActions-cb15ede7.js";import{S as se}from"./Select-9b9debbb.js";import{D as ae}from"./DatePicker-f4314872.js";import{T as re,C as z}from"./Table-8b23f94b.js";import{C as ne}from"./Chip-5cfc0777.js";import"./useControlled-138fc601.js";import"./useEventCallback-469884d9.js";import"./index-677c1661.js";import"./styled-ee573952.js";import"./Typography-40bc49a3.js";import"./Paper-862ef224.js";import"./useMediaQuery-a8cdde77.js";import"./useFormControl-b799abd8.js";import"./ownerWindow-ac4bdde2.js";import"./createSvgIcon-d571b62c.js";import"./DialogContext-fbabc464.js";import"./FormControlContext-cf683adc.js";const oe=()=>{const[c,o]=l.useState([]),[r,u]=l.useState(1),[d,b]=l.useState(5),[g,_]=l.useState({room_id:"",reservation_date:"",start_time:"",end_time:"",reservation_reason:""}),[j,y]=l.useState(""),[m,T]=l.useState(null),[i,h]=I.useState([]),[v,R]=I.useState(!1),C=t=>{const a=i.includes(t)?i.filter(p=>p!==t):[...i,t];h(a)},s=()=>{const t=c.map(p=>p.reservation_id);h(v?[]:t),R(!v)},f=async()=>{for(const t of i)await w("0",t);await n(),h([])},N=async()=>{for(const t of i)await w("2",t);await n(),h([])},B=async()=>{for(const t of i)await w("1",t);await n(),h([])},Y=async t=>{for(const a of i)await w(t,a);await n(),h([])},F=async(t,a)=>{const p=a;y(p),await Y(p)},M=t=>{T(t),t===null&&y("")},n=l.useCallback(async()=>{try{const t={page:r,pageSize:d};j!==""&&(t.reservation_status=j),m!==null&&(t.reservation_date=m.toISOString());const a=await Z.getReservationList(t);return console.log(a),Array.isArray(a.reservelist)?o(a.reservelist):console.error("Invalid data structure:",a.data),a.data}catch(t){throw console.error("Error fetching reservation data:",t),t}},[r,d,j,m]);l.useEffect(()=>{n()},[n,r,d]);const O=async()=>(await P.post("/reservation/searchroom",{room_capacity:"",room_level:"",room_type:"",room_number:"",reservation_date:"",start_time:"",end_time:""})).data,G=async()=>{const t=await P.post("/reservation/reserve",{...g});return await n(),t.data},w=async(t,a)=>{const p=t;try{const D=await P.patch("/reservation/updatestatus",{},{params:{reservation_id:a,reservation_status:p}});return await n(),D.data}catch{H.error("Time slot is not available")}};return{page:r,rowsPerPage:d,reservationData:g,reservedtList:c,reservationStatus:j,reservationDate:m,selectAllChecked:v,selectedItems:i,handleChangePage:async t=>{u(t),await n()},handleChangeRowsPerPage:async t=>{b(t),u(1),await n()},fetchReservedList:n,updateReservationStatus:w,reserveRoom:G,searchRoom:O,setReservationData:_,setListItems:o,handleToggleCheckbox:C,handleToggleSelectAll:s,handleCancel:f,handleApprove:N,handleInProgress:B,handleDateChange:M,handleStatusChange:F}},De=()=>{const{page:c,rowsPerPage:o,reservedtList:r,reservationStatus:u,reservationDate:d,selectAllChecked:b,selectedItems:g,handleChangePage:_,handleChangeRowsPerPage:j,handleToggleCheckbox:y,handleToggleSelectAll:m,handleCancel:T,handleApprove:i,handleInProgress:h,handleDateChange:v,handleStatusChange:R,fetchReservedList:C}=oe();return l.useEffect(()=>{C()},[c,o,u,d,C]),e.jsxs($,{children:[e.jsxs(k,{container:!0,spacing:2,sx:{flexGrow:1},children:[e.jsxs(k,{children:[e.jsx(L,{children:"Select Status"}),e.jsxs(se,{placeholder:"Select status",value:u,onChange:R,children:[e.jsx(S,{value:"",children:"All"}),e.jsx(S,{value:"2",children:"Approve"}),e.jsx(S,{value:"1",children:"In Progress"}),e.jsx(S,{value:"0",children:"Cancel"})]})]}),e.jsxs(k,{children:[e.jsx(L,{children:"Select Date"}),e.jsx(ee,{dateAdapter:te,adapterLocale:"th",children:e.jsxs(X,{style:{position:"relative"},children:[e.jsx(ae,{className:"datetime-picker",format:"DD MMMM YYYY",value:d,onChange:v}),e.jsx("img",{className:"position-absolute top-0 right-0",style:{pointerEvents:"none",transform:"translate(-50%,20%)"},src:"https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Objects/Tear-Off%20Calendar.png",alt:"Stopwatch",width:"25",height:"25"})]})})]})]}),e.jsxs(q,{children:[e.jsxs(J,{children:[e.jsx(W,{sx:{"--TableCell-height":"40px","--TableHeader-height":"calc(1 * var(--TableCell-height))","--Table-firstColumnWidth":"80px","--Table-lastColumnWidth":"144px","--TableRow-stripeBackground":"rgba(0 0 0 / 0.04)","--TableRow-hoverBackground":"rgba(0 0 0 / 0.08)",height:346,overflow:"auto",backgroundColor:"nav.bg"},children:e.jsxs(re,{className:"table mb-0",borderAxis:"bothBetween",stickyHeader:!0,hoverRow:!0,sx:{"--Table-headerUnderlineThickness":"1px","--TableCell-paddingX":"10px","--TableCell-paddingY":"7px","& tr > *:first-of-type":{position:"sticky",zIndex:1,left:0,boxShadow:"1px 0 var(--TableCell-borderColor)"},"& tr > *:last-child":{position:"sticky",right:0,bgcolor:"var(--TableCell-headBackground)"}},children:[e.jsxs(K,{children:[e.jsxs("tr",{children:[e.jsx("th",{style:{width:150},children:"No"}),e.jsx("th",{style:{width:150},children:"Status"}),e.jsx("th",{style:{width:250},children:"Reservation Date"}),e.jsx("th",{style:{width:200},children:"Name"}),e.jsx("th",{style:{width:150},children:"Room"}),e.jsx("th",{style:{width:150},children:"Account Type"}),e.jsx("th",{style:{width:150},children:"Reason"}),e.jsx("th",{style:{width:150},children:"Start Time"}),e.jsx("th",{style:{width:150},children:"End Time"}),e.jsx("th",{style:{width:150},children:"Action"})]}),e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{}),e.jsx("th",{children:e.jsx(z,{checked:b,onChange:m,color:"primary",disabled:!1,size:"md"})})]})]}),e.jsxs(Q,{children:[Array.isArray(r)&&r.length===0&&e.jsx("tr",{children:e.jsx("th",{colSpan:5,children:e.jsx(U,{children:"No reservations found"})})}),Array.isArray(r)&&r.map((s,f)=>e.jsxs("tr",{className:"text-center",children:[e.jsx("th",{children:(c-1)*o+f+1}),e.jsx("th",{children:e.jsx(x,{title:s.reservation_status,arrow:!0,children:e.jsx("span",{children:e.jsx(ne,{color:s.reservation_status==="Cancel"?"danger":s.reservation_status==="In progress"?"warning":"success",variant:"solid",size:"lg",children:s.reservation_status})})})}),e.jsx("th",{children:e.jsx(x,{title:E(s.reservation_date),arrow:!0,children:e.jsx("span",{children:E(s.reservation_date)})})}),e.jsx("th",{children:e.jsx(x,{title:s.fullname,arrow:!0,children:e.jsx("span",{children:s.fullname})})}),e.jsx("th",{children:e.jsx(x,{title:s.room_number,arrow:!0,children:e.jsx("span",{children:s.room_number})})}),e.jsx("th",{children:e.jsx(x,{title:s.account_type,arrow:!0,children:e.jsx("span",{children:s.account_type})})}),e.jsx("th",{children:e.jsx(x,{title:s.reservation_reason,arrow:!0,children:e.jsx("span",{children:s.reservation_reason})})}),e.jsx("th",{children:e.jsx(x,{title:s.start_time,arrow:!0,children:e.jsx("span",{children:s.start_time})})}),e.jsx("th",{children:e.jsx(x,{title:s.end_time,arrow:!0,children:e.jsx("span",{children:s.end_time})})}),e.jsx("th",{children:e.jsx(z,{checked:g.includes(s.reservation_id),onChange:()=>y(s.reservation_id),color:"primary",disabled:!1,size:"md"})})]},s.id||f))]})]})}),e.jsx("div",{className:"pagination-container",children:e.jsx(V,{count:100,page:c,rowsPerPage:o,onPageChange:_,onRowsPerPageChange:j})})]}),e.jsxs("div",{className:"d-flex mx-auto gap-3 mt-3",children:[e.jsx(A,{color:"success",size:"lg",onClick:i,disabled:g.length===0,children:"Approve"}),e.jsx(A,{color:"warning",size:"lg",onClick:h,disabled:g.length===0,children:"In Progress"}),e.jsx(A,{color:"danger",size:"lg",onClick:T,disabled:g.length===0,children:"Cancel"})]})]})]})},E=c=>{const o=new Date(c),r=o.getFullYear(),u=(o.getMonth()+1).toString().padStart(2,"0");return`${o.getDate().toString().padStart(2,"0")}/${u}/${r}`};export{De as default};
